provider: aws
logLevel: info
domainFilters:
  - {{ requiredEnv "PUBLIC_HOSTED_ZONE" }}
txtOwnerId: {{ requiredEnv "CLUSTER_NAME" }}
txtPrefix: k8s.
sources:
  - service
  - ingress
policy: sync
registry: txt
interval: 1m
triggerLoopOnEvent: true
serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: {{ requiredEnv "EXTERNAL_DNS_IAM_ROLE_ARN" }}
  name: external-dns
podSecurityContext:
  enabled: true
  fsGroup: 65534
containerSecurityContext:
  enabled: true
  runAsNonRoot: true
  runAsUser: 65534
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
metrics:
  enabled: true
  serviceMonitor:
    enabled: true
    additionalLabels:
      release: kube-prometheus-stack
    metricRelabelings:
      - action: keep
        sourceLabels: [__name__]
        regex: external_dns_.+
resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 256Mi
podDisruptionBudget:
  enabled: true
  minAvailable: 1
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - external-dns
        topologyKey: kubernetes.io/hostname
topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: DoNotSchedule
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: external-dns
