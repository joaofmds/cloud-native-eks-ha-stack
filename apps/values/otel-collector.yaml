mode: deployment
replicaCount: 2
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 60
  targetMemoryUtilizationPercentage: 70
serviceAccount:
  create: true
podSecurityContext:
  runAsNonRoot: true
  fsGroup: 10001
containerSecurityContext:
  runAsNonRoot: true
  runAsUser: 10001
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - otel-collector
          topologyKey: kubernetes.io/hostname
podDisruptionBudget:
  enabled: true
  minAvailable: 1
config:
  receivers:
    otlp:
      protocols:
        grpc:
        http:
  processors:
    memory_limiter:
      limit_mib: 400
      spike_limit_mib: 200
      check_interval: 1s
    batch:
      timeout: 5s
      send_batch_max_size: 512
      send_batch_size: 256
    k8sattributes:
      auth_type: serviceAccount
      passthrough: false
      pod_association:
        - sources:
            - from: resource_attribute
              name: k8s.pod.ip
    resource:
      attributes:
        - action: insert
          key: k8s.cluster.name
          value: {{ requiredEnv "CLUSTER_NAME" }}
  exporters:
    otlp/tempo:
      endpoint: tempo-distributor.monitoring.svc.cluster.local:4317
      tls:
        insecure: true
    loki:
      endpoint: http://loki.monitoring.svc.cluster.local:3100/loki/api/v1/push
      labels:
        resource:
          service.name: service
    logging:
      loglevel: warn
  extensions:
    health_check: {}
    pprof: {}
  service:
    extensions: [pprof, health_check]
    pipelines:
      traces:
        receivers: [otlp]
        processors: [memory_limiter, k8sattributes, resource, batch]
        exporters: [otlp/tempo]
      logs:
        receivers: [otlp]
        processors: [k8sattributes, resource, batch]
        exporters: [loki]
serviceMonitor:
  enabled: true
  additionalLabels:
    release: kube-prometheus-stack
resources:
  requests:
    cpu: 200m
    memory: 256Mi
  limits:
    cpu: 1
    memory: 512Mi
